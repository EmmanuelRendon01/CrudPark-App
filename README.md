# CrudPark â€” AplicaciÃ³n Operativa de Escritorio (Java)

Este repositorio contiene el mÃ³dulo operativo del sistema de gestiÃ³n de parqueaderos **CrudPark**. Es una aplicaciÃ³n de escritorio desarrollada en Java que permite a los operadores gestionar el flujo diario de vehÃ­culos (ingresos, salidas, cobros y emisiÃ³n de tickets) en tiempo real.

Esta aplicaciÃ³n se conecta a una base de datos **PostgreSQL** compartida con el mÃ³dulo administrativo web (desarrollado en .NET/C#).

---

## ğŸ›  TecnologÃ­as y Versiones Utilizadas

El proyecto ha sido construido utilizando las siguientes tecnologÃ­as y librerÃ­as:

*   **Lenguaje:** Java JDK **21**
*   **Gestor de ConstrucciÃ³n:** Apache Maven 3.x
*   **Interfaz GrÃ¡fica (GUI):** Java Swing
*   **Base de Datos:** PostgreSQL
*   **Conector JDBC:** `org.postgresql:postgresql:42.7.3`
*   **GeneraciÃ³n de CÃ³digos QR:** ZXing (`com.google.zxing:core:3.5.3` y `javase:3.5.3`)
*   **ImpresiÃ³n:** Java Print Service API (Nativa del JDK)

---

## ğŸ—ï¸ Arquitectura del Software

El proyecto sigue una arquitectura robusta y escalable basada en capas: **MVC (Modelo-Vista-Controlador) + Capa de Servicio + PatrÃ³n Repositorio (DAO)**.

1.  **View (Vista):** Clases Swing (`LoginView`, `MainView`) que solo manejan la presentaciÃ³n y los eventos de la interfaz.
2.  **Controller (Controlador):** Orquestan la comunicaciÃ³n entre la vista y los servicios. No contienen lÃ³gica de negocio compleja.
3.  **Service (Servicio):** Contiene toda la **lÃ³gica de negocio** (cÃ¡lculo de tarifas, reglas de tiempo de gracia, validaciÃ³n de mensualidades, generaciÃ³n de QR). Es el nÃºcleo de la aplicaciÃ³n.
4.  **Repository (Repositorio/DAO):** Interfaces e implementaciones encargadas exclusivamente de la comunicaciÃ³n con la base de datos mediante JDBC.
5.  **Model (Modelo):** POJOs que representan las entidades de la base de datos (`Operador`, `Estancia`, `Tarifa`, etc.).

---

## âš™ï¸ ConfiguraciÃ³n e InstalaciÃ³n

### 1. Requisitos Previos

*   Tener instalado el JDK 21.
*   Tener instalado Maven.
*   Tener acceso a una instancia de PostgreSQL.
*   (Opcional) Una impresora configurada en el sistema operativo para la impresiÃ³n real de tickets.

### 2. ConfiguraciÃ³n de la Base de Datos

Ejecuta el siguiente script SQL en tu base de datos PostgreSQL para crear el esquema necesario. **Es importante respetar el orden para evitar errores de claves forÃ¡neas.**

```sql
CREATE TYPE stay_type_enum AS ENUM ('Membership', 'Guest');
CREATE TYPE stay_status_enum AS ENUM ('INSIDE', 'OUTSIDE');

CREATE TABLE operators (
    operator_id         INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    password_hash       VARCHAR(255) NOT NULL,
    full_name           VARCHAR(100) NOT NULL,
    email               VARCHAR(100) UNIQUE,
    is_active           BOOLEAN NOT NULL DEFAULT TRUE,
    created_at          TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE rates (
    rate_id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    description VARCHAR(255) NOT NULL,
    vehicle_type VARCHAR(50) NOT NULL,
    hourly_rate DECIMAL(10, 2) NOT NULL,
    fraction_rate DECIMAL(10, 2) NOT NULL,
    daily_cap DECIMAL(10, 2),
    grace_period_minutes INT NOT NULL,
    is_active BOOLEAN NOT NULL
);

CREATE TABLE customers (
    customer_id         INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    full_name           VARCHAR(150) NOT NULL,
    email               VARCHAR(100) NOT NULL UNIQUE
);

CREATE TABLE memberships (
    membership_id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    customer_id INT NOT NULL, 
    license_plate VARCHAR(20) NOT NULL,
    vehicle_type VARCHAR(50) NOT NULL,
    start_date TIMESTAMP NOT NULL,
    end_date TIMESTAMP NOT NULL,
    is_active BOOLEAN NOT NULL,

    CONSTRAINT fk_customer
        FOREIGN KEY(customer_id) 
        REFERENCES customers(customer_id)
);

CREATE TABLE stays (
    stay_id             INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    license_plate       VARCHAR(10) NOT NULL,
    entry_timestamp     TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT CURRENT_TIMESTAMP,
    exit_timestamp      TIMESTAMP WITH TIME ZONE,
    stay_type           stay_type_enum NOT NULL,
    status              stay_status_enum NOT NULL DEFAULT 'INSIDE',
    entry_operator_id   INT NOT NULL,
    exit_operator_id    INT,

    CONSTRAINT fk_entry_operator
        FOREIGN KEY(entry_operator_id)
        REFERENCES operators(operator_id),

    CONSTRAINT fk_exit_operator
        FOREIGN KEY(exit_operator_id)
        REFERENCES operators(operator_id),

    CONSTRAINT valid_exit_time CHECK (exit_timestamp IS NULL OR exit_timestamp >= entry_timestamp)
);

CREATE TABLE payments (
    payment_id          INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    stay_id             INT NOT NULL UNIQUE,
    amount              DECIMAL(10, 2) NOT NULL CHECK (amount > 0),
    payment_timestamp   TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT CURRENT_TIMESTAMP,
    payment_method      VARCHAR(50),
    operator_id         INT NOT NULL,

    CONSTRAINT fk_stay
        FOREIGN KEY(stay_id)
        REFERENCES stays(stay_id),

    CONSTRAINT fk_operator
        FOREIGN KEY(operator_id)
        REFERENCES operators(operator_id)
);
```

---

### 3. ConfiguraciÃ³n de la ConexiÃ³n JDBC

Edita el archivo de configuraciÃ³n de conexiÃ³n a la base de datos (`DatabaseConnection.java`) con los parÃ¡metros de tu servidor PostgreSQL (host, puerto, base de datos, usuario y contraseÃ±a).

---

## â–¶ï¸ EjecuciÃ³n

1. Clona este repositorio:
   ```sh
   git clone <url-del-repositorio>
   ```
2. Accede a la carpeta del proyecto:
   ```sh
   cd CrudPark-App
   ```
3. Compila el proyecto con Maven:
   ```sh
   mvn clean install
   ```
4. Ejecuta la aplicaciÃ³n:
   ```sh
   mvn exec:java -Dexec.mainClass="Main"
   ```

---

## ğŸ“ Estructura del Proyecto

```
CrudPark-App/
â”œâ”€â”€ src/
â”‚   â””â”€â”€ main/
â”‚       â””â”€â”€ java/
â”‚           â”œâ”€â”€ Main.java
â”‚           â”œâ”€â”€ config/
â”‚           â”œâ”€â”€ controller/
â”‚           â”œâ”€â”€ dao/
â”‚           â”œâ”€â”€ model/
â”‚           â”œâ”€â”€ service/
â”‚           â””â”€â”€ view/
â”œâ”€â”€ pom.xml
â””â”€â”€ README.md
```

- **config/**: ConfiguraciÃ³n de la base de datos y otros recursos.
- **controller/**: Controladores de la lÃ³gica de presentaciÃ³n.
- **dao/**: Interfaces y repositorios para acceso a datos.
- **model/**: Entidades del dominio.
- **service/**: LÃ³gica de negocio y servicios.
- **view/**: Interfaces grÃ¡ficas (Swing).

---

## ğŸ‘¥ CrÃ©ditos

Desarrollado por el equipo de CrudPark. Puedes contribuir abriendo issues o pull requests.

---

## ğŸ“„ Licencia

Este proyecto estÃ¡ bajo la licencia MIT. Consulta el archivo LICENSE para mÃ¡s detalles.
