# CrudPark — Aplicación Operativa de Escritorio (Java)

Este repositorio contiene el módulo operativo del sistema de gestión de parqueaderos **CrudPark**. Es una aplicación de escritorio desarrollada en Java que permite a los operadores gestionar el flujo diario de vehículos (ingresos, salidas, cobros y emisión de tickets) en tiempo real.

Esta aplicación se conecta a una base de datos **PostgreSQL** compartida con el módulo administrativo web (desarrollado en .NET/C#).

---

## 🛠 Tecnologías y Versiones Utilizadas

El proyecto ha sido construido utilizando las siguientes tecnologías y librerías:

*   **Lenguaje:** Java JDK **21**
*   **Gestor de Construcción:** Apache Maven 3.x
*   **Interfaz Gráfica (GUI):** Java Swing
*   **Base de Datos:** PostgreSQL
*   **Conector JDBC:** `org.postgresql:postgresql:42.7.3`
*   **Generación de Códigos QR:** ZXing (`com.google.zxing:core:3.5.3` y `javase:3.5.3`)
*   **Impresión:** Java Print Service API (Nativa del JDK)

---

## 🏗️ Arquitectura del Software

El proyecto sigue una arquitectura robusta y escalable basada en capas: **MVC (Modelo-Vista-Controlador) + Capa de Servicio + Patrón Repositorio (DAO)**.

1.  **View (Vista):** Clases Swing (`LoginView`, `MainView`) que solo manejan la presentación y los eventos de la interfaz.
2.  **Controller (Controlador):** Orquestan la comunicación entre la vista y los servicios. No contienen lógica de negocio compleja.
3.  **Service (Servicio):** Contiene toda la **lógica de negocio** (cálculo de tarifas, reglas de tiempo de gracia, validación de mensualidades, generación de QR). Es el núcleo de la aplicación.
4.  **Repository (Repositorio/DAO):** Interfaces e implementaciones encargadas exclusivamente de la comunicación con la base de datos mediante JDBC.
5.  **Model (Modelo):** POJOs que representan las entidades de la base de datos (`Operador`, `Estancia`, `Tarifa`, etc.).

---

## ⚙️ Configuración e Instalación

### 1. Requisitos Previos

*   Tener instalado el JDK 21.
*   Tener instalado Maven.
*   Tener acceso a una instancia de PostgreSQL.
*   (Opcional) Una impresora configurada en el sistema operativo para la impresión real de tickets.

### 2. Configuración de la Base de Datos

Ejecuta el siguiente script SQL en tu base de datos PostgreSQL para crear el esquema necesario. **Es importante respetar el orden para evitar errores de claves foráneas.**

```sql
CREATE TYPE stay_type_enum AS ENUM ('Membership', 'Guest');
CREATE TYPE stay_status_enum AS ENUM ('INSIDE', 'OUTSIDE');

CREATE TABLE operators (
    operator_id         INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    password_hash       VARCHAR(255) NOT NULL,
    full_name           VARCHAR(100) NOT NULL,
    email               VARCHAR(100) UNIQUE,
    is_active           BOOLEAN NOT NULL DEFAULT TRUE,
    created_at          TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE rates (
    rate_id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    description VARCHAR(255) NOT NULL,
    vehicle_type VARCHAR(50) NOT NULL,
    hourly_rate DECIMAL(10, 2) NOT NULL,
    fraction_rate DECIMAL(10, 2) NOT NULL,
    daily_cap DECIMAL(10, 2),
    grace_period_minutes INT NOT NULL,
    is_active BOOLEAN NOT NULL
);

CREATE TABLE customers (
    customer_id         INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    full_name           VARCHAR(150) NOT NULL,
    email               VARCHAR(100) NOT NULL UNIQUE
);

CREATE TABLE memberships (
    membership_id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    customer_id INT NOT NULL, 
    license_plate VARCHAR(20) NOT NULL,
    vehicle_type VARCHAR(50) NOT NULL,
    start_date TIMESTAMP NOT NULL,
    end_date TIMESTAMP NOT NULL,
    is_active BOOLEAN NOT NULL,

    CONSTRAINT fk_customer
        FOREIGN KEY(customer_id) 
        REFERENCES customers(customer_id)
);

CREATE TABLE stays (
    stay_id             INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    license_plate       VARCHAR(10) NOT NULL,
    entry_timestamp     TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT CURRENT_TIMESTAMP,
    exit_timestamp      TIMESTAMP WITH TIME ZONE,
    stay_type           stay_type_enum NOT NULL,
    status              stay_status_enum NOT NULL DEFAULT 'INSIDE',
    entry_operator_id   INT NOT NULL,
    exit_operator_id    INT,

    CONSTRAINT fk_entry_operator
        FOREIGN KEY(entry_operator_id)
        REFERENCES operators(operator_id),

    CONSTRAINT fk_exit_operator
        FOREIGN KEY(exit_operator_id)
        REFERENCES operators(operator_id),

    CONSTRAINT valid_exit_time CHECK (exit_timestamp IS NULL OR exit_timestamp >= entry_timestamp)
);

CREATE TABLE payments (
    payment_id          INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    stay_id             INT NOT NULL UNIQUE,
    amount              DECIMAL(10, 2) NOT NULL CHECK (amount > 0),
    payment_timestamp   TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT CURRENT_TIMESTAMP,
    payment_method      VARCHAR(50),
    operator_id         INT NOT NULL,

    CONSTRAINT fk_stay
        FOREIGN KEY(stay_id)
        REFERENCES stays(stay_id),

    CONSTRAINT fk_operator
        FOREIGN KEY(operator_id)
        REFERENCES operators(operator_id)
);
```

---

### 3. Configuración de la Conexión JDBC

Edita el archivo de configuración de conexión a la base de datos (`DatabaseConnection.java`) con los parámetros de tu servidor PostgreSQL (host, puerto, base de datos, usuario y contraseña).

---

## ▶️ Ejecución

1. Clona este repositorio:
   ```sh
   git clone <url-del-repositorio>
   ```
2. Accede a la carpeta del proyecto:
   ```sh
   cd CrudPark-App
   ```
3. Compila el proyecto con Maven:
   ```sh
   mvn clean install
   ```
4. Ejecuta la aplicación:
   ```sh
   mvn exec:java -Dexec.mainClass="Main"
   ```

---

## 📁 Estructura del Proyecto

```
CrudPark-App/
├── src/
│   └── main/
│       └── java/
│           ├── Main.java
│           ├── config/
│           ├── controller/
│           ├── dao/
│           ├── model/
│           ├── service/
│           └── view/
├── pom.xml
└── README.md
```

- **config/**: Configuración de la base de datos y otros recursos.
- **controller/**: Controladores de la lógica de presentación.
- **dao/**: Interfaces y repositorios para acceso a datos.
- **model/**: Entidades del dominio.
- **service/**: Lógica de negocio y servicios.
- **view/**: Interfaces gráficas (Swing).

---

## 👥 Créditos

Desarrollado por el equipo de CrudPark. Puedes contribuir abriendo issues o pull requests.

---

## 📄 Licencia

Este proyecto está bajo la licencia MIT. Consulta el archivo LICENSE para más detalles.
